---
title: Luáº­n Giáº£i 12 Cung Tá»­ Vi Chi Tiáº¿t â€” PhiÃªn báº£n Giáº£i Pháº«u ToÃ n Diá»‡n
status: DRAFT
version: 2.0.0
created: 2026-02-28
feature: prompt-enhancement-12-cung
parent-spec: prompt-luan-giai-chuyen-sau/spec.md (v1.2.0)
---

## 1. Overview

NÃ¢ng cáº¥p logic Prompt luáº­n giáº£i Tá»­ Vi tá»« má»©c "tÃ³m táº¯t má»—i cung 4-12 cÃ¢u" lÃªn má»©c **Giáº£i pháº«u toÃ n diá»‡n** â€” má»—i cung Ä‘Æ°á»£c phÃ¢n tÃ­ch dÆ°á»›i nhiá»u lá»›p Ã½ nghÄ©a thá»±c tiá»…n: tÃ¡c Ä‘á»™ng cá»¥ thá»ƒ tá»›i cuá»™c Ä‘á»i, má»‘i liÃªn há»‡ vá»›i nhÃ  Ä‘áº» (bÃªn cha máº¹ ruá»™t) vÃ  nhÃ  phá»‘i ngáº«u (bÃªn gia Ä‘Ã¬nh chá»“ng/vá»£), cÃ¹ng cÃ¡c biáº¿n thá»ƒ theo váº­n háº¡n.

> **Triáº¿t lÃ½:** Trong Tá»­ Vi Äáº©u Sá»‘, má»—i cung KHÃ”NG chá»‰ pháº£n Ã¡nh 1 khÃ­a cáº¡nh duy nháº¥t. Cung Má»†NH khÃ´ng chá»‰ lÃ  "báº£n thÃ¢n" mÃ  cÃ²n áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡ch gia Ä‘Ã¬nh hai bÃªn nhÃ¬n nháº­n Ä‘Æ°Æ¡ng sá»‘. Cung PHU THÃŠ khÃ´ng chá»‰ lÃ  "hÃ´n nhÃ¢n" mÃ  cÃ²n pháº£n Ã¡nh sá»± giao thoa giá»¯a hai dÃ²ng há». Feature nÃ y yÃªu cáº§u AI bÃ³c tÃ¡ch cÃ¡c táº§ng Ã½ nghÄ©a Ä‘Ã³.

## 2. NghiÃªn Cá»©u: Ã NghÄ©a Tháº­t Sá»± Cá»§a 12 Cung

### ğŸ“ Báº¢NG PHÃ‚N RÃƒ 12 CUNG â€” TÃC Äá»˜NG ÄA CHIá»€U

| Cung | Ã nghÄ©a chÃ­nh | TÃ¡c Ä‘á»™ng thá»±c táº¿ (thÆ°á»ng bá»‹ bá» sÃ³t) | LiÃªn há»‡ NhÃ  Äáº» | LiÃªn há»‡ NhÃ  Phá»‘i Ngáº«u |
|------|---------------|--------------------------------------|-----------------|------------------------|
| **Má»†NH** | Báº£n thÃ¢n, tÃ­nh cÃ¡ch, tÆ°á»›ng máº¡o, váº­n má»‡nh tá»•ng thá»ƒ | CÃ¡ch ngÆ°á»i khÃ¡c nhÃ¬n nháº­n mÃ¬nh. Quyáº¿t Ä‘á»‹nh "aura" khi giao tiáº¿p. áº¢nh hÆ°á»Ÿng Ä‘áº¿n sá»± thÃ nh báº¡i trong má»i lÄ©nh vá»±c. | LÃ  "máº·t tiá»n" cá»§a dÃ²ng há» â€” má»‡nh tá»‘t = gia Ä‘Ã¬nh ná»Ÿ mÃ y ná»Ÿ máº·t. | LÃ  hÃ¬nh áº£nh mÃ  nhÃ  chá»“ng/vá»£ Ä‘Ã¡nh giÃ¡ trÆ°á»›c khi cÆ°á»›i. |
| **HUYNH Äá»†** | Anh chá»‹ em ruá»™t, báº¡n bÃ¨ thÃ¢n, Ä‘á»“ng nghiá»‡p ngang hÃ ng | Kháº£ nÄƒng há»£p tÃ¡c, quan há»‡ Ä‘á»‘i tÃ¡c kinh doanh, tÃ¬nh báº¡n giá»¯a cÃ¡c cá»• Ä‘Ã´ng. | Anh chá»‹ em BÃŠN NHÃ€ Äáºº â€” ai giÃºp Ä‘Æ°á»£c, ai ganh ghÃ©t. | Anh chá»‹ em BÃŠN Vá»¢/CHá»’NG (em vá»£, anh rá»ƒ...) â€” hÃ²a thuáº­n hay xung Ä‘á»™t. |
| **PHU THÃŠ** | HÃ´n nhÃ¢n, ngÆ°á»i phá»‘i ngáº«u, tÃ¬nh duyÃªn | Tuá»•i káº¿t hÃ´n, Ä‘áº·c Ä‘iá»ƒm ngoáº¡i hÃ¬nh vá»£/chá»“ng, háº¡nh phÃºc hay lá»¥c Ä‘á»¥c. Soi cáº£ tÃ¬nh nhÃ¢n/ngÆ°á»i thá»© 3. | Cha máº¹ Ä‘áº» cÃ³ Ä‘á»“ng Ã½ cuá»™c hÃ´n nhÃ¢n khÃ´ng? CÃ³ sá»± xung Ä‘á»™t "giá»¯ con" tá»« nhÃ  Ä‘áº»? | NhÃ  chá»“ng/vá»£ Ä‘á»‘i xá»­ tháº¿ nÃ o? Máº¹ chá»“ng/nÃ ng dÃ¢u cÃ³ mÃ¢u thuáº«n? |
| **Tá»¬ Tá»¨C** | Con cÃ¡i, háº­u duá»‡, tÃ¬nh dá»¥c, sÃ¡ng táº¡o | Sá»‘ lÆ°á»£ng con, giá»›i tÃ­nh, tÃ­nh cÃ¡ch, tÃ i nÄƒng Ä‘áº·c biá»‡t. Cung nÃ y cÃ²n nÃ³i vá» kháº£ nÄƒng sÃ¡ng táº¡o vÃ  háº­u váº­n. | ChÃ¡u ná»™i/ngoáº¡i â€” con mÃ¬nh cÃ³ hiáº¿u tháº£o vá»›i Ã´ng bÃ  BÃŠN Ná»˜I khÃ´ng? | Con mÃ¬nh cÃ³ gáº§n gÅ©i Ã´ng bÃ  BÃŠN NGOáº I (nhÃ  vá»£/chá»“ng) khÃ´ng? |
| **TÃ€I Báº CH** | Tiá»n báº¡c, thu nháº­p, kháº£ nÄƒng kiáº¿m tiá»n | Nguá»“n thu chÃ­nh (kinh doanh/lÆ°Æ¡ng), cÃ¡ch chi tiÃªu, cÃ³ giá»¯ Ä‘Æ°á»£c tiá»n khÃ´ng. | CÃ³ Ä‘Æ°á»£c thá»«a káº¿ tá»« nhÃ  Ä‘áº»? Cha máº¹ cÃ³ cho vá»‘n ban Ä‘áº§u? | Vá»£/chá»“ng cÃ³ mang tiá»n vÃ o nhÃ ? CÃ³ pháº£i nuÃ´i nhÃ  chá»“ng/vá»£? |
| **Táº¬T ÃCH** | Sá»©c khá»e, bá»‡nh táº­t, tai náº¡n, tÃ¢m bá»‡nh | Bá»‡nh mÃ£n tÃ­nh, bá»™ pháº­n dá»… tá»•n thÆ°Æ¡ng, tÃ¢m lÃ½ stress. | Di truyá»n bá»‡nh tá»« dÃ²ng há» Ná»˜I/NGOáº I? | Vá»£/chá»“ng cÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n sá»©c khá»e mÃ¬nh? (Stress hÃ´n nhÃ¢n â†’ bá»‡nh) |
| **THIÃŠN DI** | Di chuyá»ƒn, Ä‘i xa, quan há»‡ xÃ£ há»™i bÃªn ngoÃ i | CÃ³ nÃªn lÃ m Äƒn xa nhÃ ? NgÆ°á»i nÆ¡i khÃ¡c cÃ³ giÃºp mÃ¬nh khÃ´ng? Soi vá» hÃ¬nh áº£nh cÃ´ng khai. | CÃ³ rá»i xa nhÃ  Ä‘áº» Ä‘á»ƒ láº­p nghiá»‡p? Xa cha máº¹ cÃ³ phÃ¡t hay suy? | CÃ³ pháº£i theo vá»£/chá»“ng Ä‘i xa? Xa nhÃ  chá»“ng/vá»£ cÃ³ thuáº­n lá»£i hÆ¡n? |
| **NÃ” Bá»˜C** | Thuá»™c háº¡, nhÃ¢n viÃªn, báº¡n bÃ¨, quÃ½ nhÃ¢n | CÃ³ quÃ½ nhÃ¢n giÃºp Ä‘á»¡? Cáº¥p dÆ°á»›i cÃ³ trung thÃ nh? Báº¡n bÃ¨ cÃ³ lá»£i dá»¥ng? | Báº¡n bÃ¨ thá»i thÆ¡ áº¥u (tá»« quÃª/nhÃ  Ä‘áº») cÃ³ giÃºp Ã­ch? | Báº¡n bÃ¨ /quan há»‡ xÃ£ há»™i phÃ¡t sinh SAU khi cÆ°á»›i â€” cÃ³ thuáº­n lá»£i? |
| **QUAN Lá»˜C** | Sá»± nghiá»‡p, nghá» nghiá»‡p, danh vá»ng, quyá»n lá»±c | Nghá» phÃ¹ há»£p, thá»i Ä‘iá»ƒm thÄƒng tiáº¿n, cÃ³ quyá»n lá»±c khÃ´ng, kinh doanh hay lÃ m thuÃª. | Cha máº¹ Ä‘áº» cÃ³ truyá»n nghá»/truyá»n ngÃ´i? CÃ³ káº¿ thá»«a sá»± nghiá»‡p gia Ä‘Ã¬nh? | Vá»£/chá»“ng cÃ³ há»— trá»£/cáº£n trá»Ÿ sá»± nghiá»‡p? NhÃ  vá»£/chá»“ng cÃ³ cho cÆ¡ há»™i? |
| **ÄIá»€N TRáº CH** | NhÃ  cá»­a, báº¥t Ä‘á»™ng sáº£n, tÃ i sáº£n cá»‘ Ä‘á»‹nh | Kháº£ nÄƒng mua nhÃ , cÃ³ Ä‘áº¥t thá»«a káº¿, nhÃ  á»Ÿ tá»‘t hay xáº¥u (phong thá»§y). | CÃ³ Ä‘Æ°á»£c thá»«a káº¿ nhÃ  Ä‘áº¥t tá»« cha máº¹? NhÃ  Ä‘áº» cÃ³ cho á»Ÿ nhá»? | á» nhÃ  chá»“ng/vá»£ hay ra riÃªng? Mua nhÃ  chung hay riÃªng? |
| **PHÃšC Äá»¨C** | PhÃºc pháº§n tá»• tiÃªn, Ã¢m Ä‘á»©c, tÃ¢m linh, "gá»‘c rá»…" | ÄÆ°á»ng má»™ pháº§n, sá»± phÃ¹ há»™/trÃ©o ngoe tá»« gia tiÃªn. Cung nÃ y lÃ  Gá»C Rá»„ quyáº¿t Ä‘á»‹nh má»i cung khÃ¡c. | DÃ²ng há» Ná»˜I phÃºc dÃ y hay má»ng? Má»™ pháº§n Ã´ng bÃ  ná»™i cÃ³ á»•n? | DÃ²ng há» Vá»¢/CHá»’NG cÃ³ Ã¢m Ä‘á»©c khÃ´ng? Khi cÆ°á»›i vÃ o cÃ³ bá»‹ áº£nh hÆ°á»Ÿng pháº§n Ã¢m nhÃ  bÃªn kia? |
| **PHá»¤ MáºªU** | Cha máº¹, cáº¥p trÃªn, tháº§y cÃ´, ngÆ°á»i báº£o trá»£ | Quan há»‡ vá»›i cha máº¹ Ä‘áº», sá»± há»— trá»£ tá»« cáº¥p trÃªn, cÃ³ quÃ½ nhÃ¢n bá» trÃªn nÃ¢ng Ä‘á»¡? | Cha máº¹ Äáºº cá»¥ thá»ƒ â€” khá»e máº¡nh hay á»‘m yáº¿u? GiÃ u hay nghÃ¨o? PhÃºc hay kháº¯c? | Cha máº¹ Vá»¢/CHá»’NG â€” tá»©c Bá» Máº¸ CHá»’NG/Vá»¢ â€” thÃ¡i Ä‘á»™ ra sao? CÃ³ há»— trá»£ hay gÃ¢y khÃ³ dá»…? |

### ğŸ”— CÃC Bá»˜ TAM Há»¢P & CHIáº¾U â€” GÃ“C NHÃŒN "2 GIA ÄÃŒNH"

| Bá»™ Tam Há»£p | Ã nghÄ©a tá»•ng thá»ƒ | GÃ³c nhÃ¬n "NhÃ  Äáº»" | GÃ³c nhÃ¬n "NhÃ  Chá»“ng/Vá»£" |
|-------------|-------------------|---------------------|--------------------------|
| **Má»‡nh â†’ TÃ i â†’ Quan** | NÄƒng lá»±c + Tiá»n + Nghá» = ThÃ nh tá»±u cÃ¡ nhÃ¢n | NhÃ  Ä‘áº» cÃ³ cho vá»‘n & truyá»n nghá»? | NhÃ  chá»“ng/vá»£ cÃ³ há»— trá»£ sá»± nghiá»‡p? |
| **Huynh Äá»‡ â†’ ThiÃªn Di â†’ Äiá»n Tráº¡ch** | Anh em + BÃªn ngoÃ i + NhÃ  cá»­a = Vá»‹ tháº¿ xÃ£ há»™i | Anh em ruá»™t cÃ³ giÃºp mua nhÃ ? | Anh em vá»£/chá»“ng cÃ³ tranh cháº¥p Ä‘áº¥t? |
| **Phu ThÃª â†’ Tá»­ Tá»©c â†’ PhÃºc Äá»©c** | DuyÃªn sá»‘ + Con cÃ¡i + Gá»‘c rá»… = Háº¡nh phÃºc gia Ä‘Ã¬nh | NhÃ  Ä‘áº» cÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n hÃ´n nhÃ¢n? | PhÃºc Ä‘á»©c 2 bÃªn cÃ³ giao thoa? |
| **Phá»¥ Máº«u â†’ Táº­t Ãch â†’ NÃ´ Bá»™c** | Bá» trÃªn + Sá»©c khá»e + QuÃ½ nhÃ¢n = Chá»— dá»±a | Cha máº¹ Ä‘áº» cÃ³ lo cho sá»©c khá»e? | Bá»‘ máº¹ chá»“ng/vá»£ cÃ³ lÃ  chá»— dá»±a? |

## 3. User Scenarios

- **US1**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c luáº­n giáº£i cung Má»†NH, tÃ´i muá»‘n hiá»ƒu khÃ´ng chá»‰ tÃ­nh cÃ¡ch mÃ  cÃ²n **cÃ¡ch nhÃ  Ä‘áº» vÃ  nhÃ  chá»“ng/vá»£ nhÃ¬n nháº­n tÃ´i** â€” Ä‘á»ƒ biáº¿t mÃ¬nh cÃ³ Ä‘Æ°á»£c yÃªu quÃ½ hai bÃªn hay khÃ´ng.

- **US2**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung HUYNH Äá»†, tÃ´i muá»‘n biáº¿t **anh chá»‹ em bÃªn nhÃ  Ä‘áº»** cÃ³ giÃºp Ä‘á»¡ Ä‘Æ°á»£c khÃ´ng, vÃ  cáº£ **anh chá»‹ em bÃªn nhÃ  vá»£/chá»“ng** (em vá»£, chá»‹ chá»“ng) liá»‡u cÃ³ hÃ²a thuáº­n hay gÃ¢y ráº¯c rá»‘i.

- **US3**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung PHU THÃŠ, tÃ´i muá»‘n hiá»ƒu sÃ¢u vá» **quan há»‡ máº¹ chá»“ng - nÃ ng dÃ¢u** / **bá»‘ vá»£ - con rá»ƒ**, cÅ©ng nhÆ° cha máº¹ Ä‘áº» cÃ³ cháº¥p nháº­n cuá»™c hÃ´n nhÃ¢n khÃ´ng.

- **US4**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung TÃ€I Báº CH, tÃ´i muá»‘n biáº¿t tÃ´i cÃ³ Ä‘Æ°á»£c **thá»«a káº¿ tÃ i sáº£n tá»« nhÃ  Ä‘áº»** khÃ´ng, vÃ  vá»£/chá»“ng cÃ³ **mang tiá»n vÃ o nhÃ  hay rÃºt tiá»n ra**.

- **US5**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung ÄIá»€N TRáº CH, tÃ´i muá»‘n biáº¿t tÃ´i sáº½ **á»Ÿ nhÃ  cha máº¹, nhÃ  chá»“ng/vá»£, hay ra riÃªng**, vÃ  cÃ³ Ä‘Æ°á»£c thá»«a káº¿ báº¥t Ä‘á»™ng sáº£n khÃ´ng.

- **US6**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung PHÃšC Äá»¨C, tÃ´i muá»‘n biáº¿t **phÃºc Ä‘á»©c dÃ²ng há» bÃªn Ná»™i** vÃ  **bÃªn Ngoáº¡i/bÃªn vá»£/chá»“ng** â€” Ä‘áº·c biá»‡t khi cÆ°á»›i vÃ o dÃ²ng há» bÃªn kia, pháº§n Ã¢m cá»§a 2 bÃªn cÃ³ "xung" nhau khÃ´ng.

- **US7**: LÃ  ngÆ°á»i dÃ¹ng, khi Ä‘á»c cung PHá»¤ MáºªU, tÃ´i muá»‘n AI phÃ¢n tÃ­ch riÃªng: Cha máº¹ Äáºº tháº¿ nÃ o, vÃ  **Bá»‘ máº¹ CHá»’NG/Vá»¢** thÃ¡i Ä‘á»™ ra sao â€” cung nÃ y káº¿t há»£p cung PHU THÃŠ sáº½ cho tháº¥y rÃµ.

- **US8**: LÃ  ngÆ°á»i dÃ¹ng, tÃ´i muá»‘n má»—i cung Ä‘Æ°á»£c luáº­n dÆ°á»›i dáº¡ng **khung phÃ¢n tÃ­ch chuáº©n** (Ã nghÄ©a â†’ TÃ¡c Ä‘á»™ng cá»¥ thá»ƒ â†’ NhÃ  Ä‘áº» â†’ NhÃ  chá»“ng/vá»£ â†’ Váº­n háº¡n) Ä‘á»ƒ dá»… hiá»ƒu, dá»… so sÃ¡nh.

- **US9**: LÃ  ngÆ°á»i dÃ¹ng, náº¿u AI luáº­n má»™t cung mÃ  **khÃ´ng Ä‘á»§ data sao** Ä‘á»ƒ suy luáº­n vá» nhÃ  chá»“ng/vá»£ (vÃ­ dá»¥: chÆ°a cÆ°á»›i), tÃ´i muá»‘n AI ghi rÃµ "Khi láº­p gia Ä‘Ã¬nh, cung nÃ y sáº½ áº£nh hÆ°á»Ÿng..." thay vÃ¬ bá» trá»‘ng.

## 4. Functional Requirements

### 4.1 Khung PhÃ¢n TÃ­ch Má»—i Cung (FR01)

Má»—i cung trong 12 cung pháº£i Ä‘Æ°á»£c luáº­n theo **5 lá»›p** sau (trÃ¬nh tá»± báº¯t buá»™c):

| Lá»›p | TÃªn | Ná»™i dung |
|-----|-----|----------|
| L1 | **Ã nghÄ©a & Tá»•ng quÃ¡t** | Luáº­n tá»•ng thá»ƒ cung theo chÃ­nh tinh + phá»¥ tinh + tá»© hÃ³a. BÃ³c tÃ¡ch 3 táº§ng ğŸ”µğŸŸ¡ğŸ”´ (cho 6 cung trá»ng yáº¿u). |
| L2 | **TÃ¡c Ä‘á»™ng thá»±c táº¿** | áº¢nh hÆ°á»Ÿng Cá»¤ THá»‚ tá»›i cuá»™c sá»‘ng: tiá»n báº¡c/sá»©c khá»e/nghá» nghiá»‡p/tÃ¬nh cáº£m â€” tÃ¹y Ä‘áº·c trÆ°ng cung. |
| L3 | **NhÃ  Äáº» (BÃªn Ná»™i/Ngoáº¡i)** | Soi áº£nh hÆ°á»Ÿng tá»«/tá»›i gia Ä‘Ã¬nh cha máº¹ ruá»™t, anh chá»‹ em ruá»™t, dÃ²ng há» gá»‘c. |
| L4 | **NhÃ  Phá»‘i Ngáº«u** | Soi áº£nh hÆ°á»Ÿng tá»«/tá»›i gia Ä‘Ã¬nh vá»£/chá»“ng (bá»‘ máº¹ chá»“ng/vá»£, anh em bÃªn kia). |
| L5 | **Biáº¿n thiÃªn theo Váº­n Háº¡n** | Äáº¡i váº­n hiá»‡n táº¡i + Tiá»ƒu váº­n Ä‘ang áº£nh hÆ°á»Ÿng cung nÃ y ra sao? |

### 4.2 Logic Soi "NhÃ  Äáº» vs NhÃ  Phá»‘i Ngáº«u" (FR02)

Äá»ƒ AI luáº­n Ä‘Æ°á»£c "2 gia Ä‘Ã¬nh", cáº§n Ã¡p dá»¥ng **quy táº¯c chuyá»ƒn cung** sau (logic Tá»­ Vi cá»• Ä‘iá»ƒn):

| Cung gá»‘c | Soi NhÃ  Äáº» báº±ng cÃ¡ch | Soi NhÃ  Phá»‘i Ngáº«u báº±ng cÃ¡ch |
|-----------|----------------------|------------------------------|
| Má»†NH | Káº¿t há»£p PHá»¤ MáºªU + HUYNH Äá»† + PHÃšC Äá»¨C | Káº¿t há»£p PHU THÃŠ (phá»‘i ngáº«u lÃ  "cá»­a ngÃµ" nhÃ  bÃªn kia) |
| HUYNH Äá»† | Trá»±c tiáº¿p = anh em ruá»™t | PHU THÃŠ chuyá»ƒn = anh em bÃªn vá»£/chá»“ng (Huynh Äá»‡ tÃ­nh tá»« cung Phu ThÃª) |
| PHU THÃŠ | PHá»¤ MáºªU (cha máº¹ Ä‘áº» cháº¥p nháº­n hÃ´n nhÃ¢n?) | Soi trá»±c tiáº¿p + PHÃšC Äá»¨C (dÃ²ng há» bÃªn kia) |
| Tá»¬ Tá»¨C | Con vs nhÃ  ná»™i = PHÃšC Äá»¨C + Tá»¬ Tá»¨C | Con vs nhÃ  ngoáº¡i = PhÃºc Äá»©c tÃ­nh tá»« Phu ThÃª |
| TÃ€I Báº CH | Thá»«a káº¿ = ÄIá»€N TRáº CH + PHá»¤ MáºªU | Vá»£/chá»“ng mang tiá»n = PHU THÃŠ + HÃ³a Lá»™c xuyÃªn cung |
| Táº¬T ÃCH | Di truyá»n bá»‡nh = PHá»¤ MáºªU + PHÃšC Äá»¨C | Stress hÃ´n nhÃ¢n = PHU THÃŠ + Táº¬T ÃCH tÆ°Æ¡ng há»— |
| THIÃŠN DI | Xa nhÃ  = má»‘i quan há»‡ xa PHá»¤ MáºªU | Theo vá»£/chá»“ng Ä‘i xa = PHU THÃŠ + THIÃŠN DI |
| NÃ” Bá»˜C | Báº¡n bÃ¨ cÅ© = thá»i tráº» con, gá»‘c gÃ¡c | Báº¡n bÃ¨ má»›i = sau khi cÆ°á»›i, qua vá»£/chá»“ng giá»›i thiá»‡u |
| QUAN Lá»˜C | Cha máº¹ truyá»n nghá» = PHá»¤ MáºªU + QUAN Lá»˜C | NhÃ  vá»£/chá»“ng cho cÆ¡ há»™i = PHU THÃŠ + TÃ€I Báº CH |
| ÄIá»€N TRáº CH | Thá»«a káº¿ Ä‘áº¥t nhÃ  Ä‘áº» = ÄIá»€N TRáº CH gá»‘c | á» nhÃ  chá»“ng/vá»£ = PHU THÃŠ + ÄIá»€N TRáº CH chuyá»ƒn cung |
| PHÃšC Äá»¨C | DÃ²ng há» Ná»˜I = ThÃ¡i DÆ°Æ¡ng + cung gá»‘c | DÃ²ng há» Vá»¢/CHá»’NG = ThÃ¡i Ã‚m + PhÃºc Äá»©c tÃ­nh tá»« Phu ThÃª |
| PHá»¤ MáºªU | Cha máº¹ Äáºº = cung gá»‘c | Bá»‘ máº¹ CHá»’NG/Vá»¢ = Phá»¥ Máº«u tÃ­nh tá»« cung Phu ThÃª |

### 4.3 Sá»‘ cÃ¢u tá»‘i thiá»ƒu má»—i cung (FR03)

| Loáº¡i cung | Min cÃ¢u | Max cÃ¢u | Ghi chÃº |
|-----------|---------|---------|---------|
| Cung HEAVY (náº·ng sao) | 12 | 20 | Báº¯t buá»™c Ä‘á»§ 5 lá»›p L1-L5 |
| Cung trá»ng yáº¿u (Má»†NH, PHU, Tá»¬, TÃ€I, QUAN, PHÃšC) | 10 | 18 | Báº¯t buá»™c 3 táº§ng ğŸ”µğŸŸ¡ğŸ”´ + Ä‘á»§ L3-L4 |
| Cung thÆ°á»ng | 6 | 12 | L3-L4 cÃ³ thá»ƒ gá»™p 1-2 cÃ¢u |

### 4.4 Output Format Má»›i Má»—i Cung (FR04)

```
[TÃŠN CUNG] â€” "TiÃªu Ä‘á» ngáº¯n tÃ³m táº¯t tÃ¬nh hÃ¬nh cung"

ğŸ”µ Thá»±c táº¡i: ... (náº¿u cung trá»ng yáº¿u)
ğŸŸ¡ Tiá»m áº©n: ...
ğŸ”´ Nghiá»‡p lá»±c: ...

ğŸ“Œ TÃ¡c Ä‘á»™ng thá»±c táº¿: [2-4 cÃ¢u cá»¥ thá»ƒ vá» tiá»n/sá»± nghiá»‡p/sá»©c khá»e/tÃ¬nh cáº£m tÃ¹y Ä‘áº·c trÆ°ng cung]

ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ BÃªn nhÃ  Ä‘áº»: [1-3 cÃ¢u â€” áº£nh hÆ°á»Ÿng tá»«/tá»›i gia Ä‘Ã¬nh ruá»™t]

ğŸ’ BÃªn nhÃ  vá»£/chá»“ng: [1-3 cÃ¢u â€” áº£nh hÆ°á»Ÿng tá»«/tá»›i gia Ä‘Ã¬nh phá»‘i ngáº«u]

â³ Váº­n háº¡n: [1-2 cÃ¢u â€” Ä‘áº¡i váº­n/tiá»ƒu váº­n Ä‘ang áº£nh hÆ°á»Ÿng cung nÃ y]
```

### 4.5 Quy Táº¯c Khi ChÆ°a Láº­p Gia ÄÃ¬nh (FR05)

- Náº¿u Ä‘Æ°Æ¡ng sá»‘ cÃ²n tráº» hoáº·c chÆ°a cÆ°á»›i â†’ Lá»›p L4 (NhÃ  Phá»‘i Ngáº«u) viáº¿t dÆ°á»›i dáº¡ng **dá»± bÃ¡o**: "Khi láº­p gia Ä‘Ã¬nh..."
- Náº¿u Ä‘Æ°Æ¡ng sá»‘ Ä‘Ã£ ly hÃ´n â†’ Ghi chÃº "DuyÃªn trÆ°á»›c Ä‘Ã£ tan, xÃ©t tÃ¡i hÃ´n..."

### 4.6 Token Budget tÄƒng (FR06)

- TÄƒng `maxOutputTokens` tá»« **12288** lÃªn **16384** Ä‘á»ƒ Ä‘á»§ khÃ´ng gian cho 12 cung chi tiáº¿t 5 lá»›p.

### 4.7 Cáº­p nháº­t Rawdata Prompt (FR07)

- Cáº­p nháº­t template prompt á»Ÿ `public/app.js` (pháº§n Copy) Ä‘á»ƒ bao gá»“m khung phÃ¢n tÃ­ch 5 lá»›p vÃ  format output má»›i.

### 4.8 Cáº­p nháº­t Gemini System Prompt (FR08)

- Cáº­p nháº­t `server/gemini.js` > `buildPrompt()` Ä‘á»ƒ bao gá»“m:
  - Rule má»›i vá» 5 lá»›p phÃ¢n tÃ­ch.
  - Logic chuyá»ƒn cung (FR02).
  - Format output má»›i cho má»—i cung (FR04).
  - Quy táº¯c khi chÆ°a láº­p gia Ä‘Ã¬nh (FR05).

### 4.9 PROMPT_VERSION Bump (FR09)

- Bump `PROMPT_VERSION` tá»« `v6.0` lÃªn `v7.0` Ä‘á»ƒ invalidate cache.

## 5. Non-Functional Requirements

- **NFR01**: Rawdata prompt khÃ´ng vÆ°á»£t quÃ¡ **15000 kÃ½ tá»±** (tÄƒng tá»« 12000 do output dÃ i hÆ¡n).
- **NFR02**: Gemini prompt khÃ´ng vÆ°á»£t quÃ¡ **15000 kÃ½ tá»±**.
- **NFR03**: `maxOutputTokens` = **16384**.
- **NFR04**: Thá»i gian AI response cháº¥p nháº­n â‰¤ 45 giÃ¢y (tÄƒng tá»« 30s vÃ¬ output dÃ i hÆ¡n).

## 6. Success Criteria

- [ ] SC01: Má»—i cung trong 12 cung pháº£i cÃ³ Ä‘á»§ 5 lá»›p phÃ¢n tÃ­ch (L1-L5).
- [ ] SC02: Tá»‘i thiá»ƒu 6 cung (Má»†NH, PHU, Tá»¬, TÃ€I, QUAN, PHÃšC) pháº£i cÃ³ ná»™i dung vá» "NhÃ  Ä‘áº»" vÃ  "NhÃ  vá»£/chá»“ng".
- [ ] SC03: Cung HUYNH Äá»† pháº£i phÃ¢n biá»‡t rÃµ anh em BÃŠN NHÃ€ Äáºº vs anh em BÃŠN Vá»¢/CHá»’NG.
- [ ] SC04: Cung PHá»¤ MáºªU pháº£i luáº­n riÃªng cha máº¹ Äáºº vs bá»‘ máº¹ CHá»’NG/Vá»¢.
- [ ] SC05: Cung PHÃšC Äá»¨C pháº£i soi Ä‘Æ°á»£c phÃºc Ä‘á»©c dÃ²ng há» BÃŠN Ná»˜I vs BÃŠN Vá»¢/CHá»’NG.
- [ ] SC06: Cung TÃ€I Báº CH pháº£i Ä‘á» cáº­p thá»«a káº¿ nhÃ  Ä‘áº» vs tÃ i chÃ­nh mang vÃ o tá»« vá»£/chá»“ng.
- [ ] SC07: Cung ÄIá»€N TRáº CH pháº£i nÃªu rÃµ: á»Ÿ nhÃ  ai? Thá»«a káº¿ Ä‘áº¥t bÃªn nÃ o?
- [ ] SC08: Format output cÃ³ icon phÃ¢n tÃ¡ch rÃµ rÃ ng (ğŸ“Œ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ğŸ’ â³).
- [ ] SC09: `PROMPT_VERSION` Ä‘Æ°á»£c bump lÃªn v7.0.
- [ ] SC10: `maxOutputTokens` = 16384.
- [ ] SC11: Parser (`parseAiResponse`) nháº­n diá»‡n Ä‘Ãºng format cung má»›i.
