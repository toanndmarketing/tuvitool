# ğŸ’» CODER - Tá»­ Vi LÃ¡ Sá»‘

## Tech Stack
- **Frontend:** Vanilla JS (KHÃ”NG React/Vue)
- **Backend:** Node.js 20 + Express
- **Database:** SQLite
- **AI:** Google Gemini API

## Coding Rules

### JavaScript
1. **Arrow functions** + `async/await` (KHÃ”NG callback)
2. **Module tÃ¡ch biá»‡t:** `app.js`, `auth.js`, `tu-vi-calc.js`, `tu-vi-render.js`
3. **API client táº­p trung:** DÃ¹ng `fetch` vá»›i base URL
4. **Error handling:** Try-catch + user-friendly messages
5. **KHÃ”NG dÃ¹ng `var`**, chá»‰ `const`/`let`

### Backend (Express)
1. **RESTful API:** `/api/auth/*`, `/api/ai/*`
2. **Validation:** Client + Server Ä‘á»u validate
3. **Middleware:** `authMiddleware` cho protected routes
4. **Error handler:** Centralized error handling
5. **Parameterized queries:** KHÃ”NG string concatenation (SQL injection)

### Security
1. **Password:** bcrypt hash (salt rounds >= 10)
2. **JWT:** HS256, expire 7 days, secret >= 32 chars
3. **Input validation:** Username (alphanumeric + _), Email (regex), Password (>= 6 chars)
4. **Rate limiting:** AI endpoints (5 req/min), Auth (5 req/15min)
5. **XSS prevention:** `textContent` thay vÃ¬ `innerHTML`

### Environment Variables
```env
PORT=8950
JWT_SECRET=<random-32-chars>
GEMINI_API_KEY=<your-key>
NODE_ENV=production
```

**Cáº¤M hard-code** API keys, URLs, secrets!

## File Structure
```
server/
â”œâ”€â”€ server.js          # Express entry
â”œâ”€â”€ db.js              # SQLite wrapper
â”œâ”€â”€ gemini.js          # Gemini client
â””â”€â”€ middleware/
    â”œâ”€â”€ auth.js        # JWT verify
    â””â”€â”€ rateLimiter.js # Rate limit

public/
â”œâ”€â”€ index.html
â”œâ”€â”€ app.js             # Main logic
â”œâ”€â”€ auth.js            # Auth UI
â”œâ”€â”€ tu-vi-calc.js      # Calculation
â”œâ”€â”€ tu-vi-render.js    # Render chart
â””â”€â”€ styles.css
```

## Naming Conventions
- **Components:** PascalCase
- **Functions/Variables:** camelCase
- **Constants:** UPPER_SNAKE_CASE
- **Files:** kebab-case.js

## Dependencies (Minimal)
```json
{
  "express": "^4.18.0",
  "better-sqlite3": "^9.0.0",
  "bcrypt": "^5.1.0",
  "jsonwebtoken": "^9.0.0",
  "@google/generative-ai": "^0.1.0"
}
```

**KHÃ”NG thÃªm** dependencies khÃ´ng cáº§n thiáº¿t!

## Workflow
1. Äá»c code hiá»‡n táº¡i
2. Implement theo standards
3. Test local vá»›i Docker
4. Commit vá»›i message rÃµ rÃ ng
